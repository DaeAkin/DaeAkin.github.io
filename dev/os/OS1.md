# CPU



## Mode bit

CPU에는 mode bit이 존재한다. 사용자가 프로그램의 **잘못된 수행**(예를 들어 무한 for문)을 실수로 실행해서, 다른 프로그램이 CPU를 사용하지 못하게 될 경우, 다른 프로그램과 운영체제에게 피해를 주기 때문에, 이를 막기위한 보호 장치로 사용한다.

Mode bit 은 두 가지 종류가 있다.

- mode bit이 1이 라면 사용자 프로그램을 실행 중이다.
- mode bit이 0이 라면 OS 코드를 실행 중이다.

mode bit이 1인 걸 **<u>사용자 모드</u>**라고 말하고, mode bit이 0 인 걸 **<u>커널 모드 또는 모니터 모드</u>**라고 한다.

I/O 접근은 보안상으로, 사용자 프로그램이 직접 접근하면 안되고, 운영체제만 접근이 가능해야만 한다. 그래서 I/O 수행은 이 mode bit을 보고 커널 모드가 의뢰한 일이면 수행을 하고, 사용자 모드가 의뢰한 일이면 수행을 하지 않는다.



## 타이머

- 정해진 시간이 흐른 뒤 OS에게 제어권이 넘어가도록 인터럽트를 발생시킨다.
- 타이머는 매 클럭 틱 때마다 1씩 감소된다.
- 타이머 값이 0이 되면 타이머 인터럽트가 발생된다.
- CPU를 특정 프로그램이 독점하는 것으로 보호하기 위해 있다.

타이머는 현재 우리가 사용하고 있는 운영체제인 windows , 리눅스 , mac 등 시분할 운영체제를 구현하기 위해 널리 이용되고 있다.



## 인터럽트

인터럽트 당한 시점의 <u>register</u>와 <u>program counter</u>를 save한 후 CPU의 제어를 인터럽트 처리 루틴에 넘긴다.

인터럽트는 크게 두 가지 종류가 있다.

- **Interrupt(하드웨어 인터럽트)** : 하드웨어가 발생시킨 인터럽트
- **Trap(소프트웨어 인터럽트)** 
  - Exception : 프로그램이 오류를 범한 경우
  - System call : 프로그램이 커널 함수를 호출하는 경우

예를 들어 자바 로직을 수행하고 있는 도중에, Scanner나 IntpuStream을 이용해서 I/O 작업이 필요하게 되어 이 클래스를 호출하게 되면, System call이 일어나게 된다. 그럼, Trap 인터럽트가 걸리게 되어서, OS에게 I/O 작업을 요청하게 된다.

**인터럽트 관련 용어**

- 인터럽트 벡터
  - 해당 인터럽트의 처리 루틴 주소를 가지고 있음
- 인터럽트 처리 루틴( = Interrupt Service Routine, 인터럽트 핸들러)
  - 해당 인터럽트를 처리하는 커널 함수

