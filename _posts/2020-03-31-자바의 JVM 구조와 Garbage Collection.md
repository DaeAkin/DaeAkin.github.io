---
layout: post
title: ìë°”ì˜ JVM êµ¬ì¡°ì™€ Garbage Collection
categories: [Java]
comments: true 
---

## JVM ë©”ëª¨ë¦¬ ëª¨ë¸ 

![]({{"/img/gc/JVMMemory.png" | relative_url}})

ìœ„ì— ì‚¬ì§„ì„ ë³´ë©´ JVM ë©”ëª¨ë¦¬ëŠ” ë¶€ë¶„ì ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. í° ë¶€ë¶„ì—ì„œ ë³´ë©´ JVM Heap ë©”ëª¨ë¦¬ëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ **Young ì˜ì—­**ê³¼ **Old ì˜ì—­** ë‘ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

## Young ì˜ì—­

Young ì˜ì—­ì€ **ìƒˆë¡œìš´ ê°ì²´ê°€ ìƒì„±ë˜ëŠ” ê³³ì…ë‹ˆë‹¤.** Young ì˜ì—­ì´ ê°€ë“ì°¨ê²Œ ë˜ë©´ GCê°€ ë™ì‘ë©ë‹ˆë‹¤. ì´ ë™ì‘ì„ **Minor GC**ë¼ê³  í•©ë‹ˆë‹¤. Young ì˜ì—­ì€ 3ê°€ì§€ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆëŠ”ë°, **Eden ê³µê°„ê³¼ ë‘ê°œì˜ Survivor ê³µê°„**ì…ë‹ˆë‹¤.

### Young ì˜ì—­ì˜ íë¦„ 

- ìµœê·¼ì— ë§Œë“¤ì–´ì§„ ê°ì²´ëŠ” Eden ì˜ì—­ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.

  ![](https://github.com/DaeAkin/DaeAkin.github.io/blob/master/img/gc/Minor1.png?raw=true)

- Eden **ì˜ì—­ì´ ê°€ë“ì°¨ë©´, Minor GC**ê°€ ë°œìƒí•˜ëŠ”ë°, ì—¬ê¸°ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ **survivor ê³µê°„ ì¤‘ í•˜ë‚˜**ë¡œ ì´ë™í•©ë‹ˆë‹¤.

  ![](https://github.com/DaeAkin/DaeAkin.github.io/blob/master/img/gc/Minor2.png?raw=true)

- Minor GCëŠ” **survivor ê³µê°„**ë„ ê°™ì´ ê²€ì‚¬ë¥¼ í•´ì„œ **ë‹¤ë¥¸ survivor ê³µê°„**ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ survivor ê³µê°„ ë‘ê°œ ì¤‘ í•˜ë‚˜ëŠ” í•­ìƒ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.

  ![](https://github.com/DaeAkin/DaeAkin.github.io/blob/master/img/gc/Minor3.png?raw=true)

- ì—¬ëŸ¬ ë²ˆì˜ Minor GCë¥¼ ë§ì´ í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤. **Minor GCë¥¼ ë‹¹í–ˆì§€ë§Œ ì‚´ì•„ë‚¨ì€ ê°ì²´ëŠ” 1ì‚´ì”©(?) ë¨¹ìŠµë‹ˆë‹¤**. ëª‡ ì‚´ì´ ë¨¹ìœ¼ë©´ Old ì˜ì—­ìœ¼ë¡œ ê°€ì•¼í•˜ëŠ”ì§€ ì„¤ì • í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

## Old ì˜ì—­

Old ì˜ì—­ì—ëŠ” ì—¬ëŸ¬ ë²ˆì˜ **Minor GCë¥¼ ê²ªê³  ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤**ì´ ìˆìŠµë‹ˆë‹¤. Old ì˜ì—­ì—ì„œ ë©”**ëª¨ë¦¬ê°€ ê°€ë“ì°¨ê²Œë˜ë©´ Major GC**ê°€ ë°œìƒí•©ë‹ˆë‹¤. 

Major GCëŠ” Minor GCì— ë¹„í•´ ë§ì€ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤.

## Stop the World(ì„¸ìƒì„ ë©ˆì¶°ë¼ ğŸ˜…)

ëª¨ë“  GCëŠ” **"Stop the World"** ë¼ëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí•©ë‹ˆë‹¤. **GCê°€ ë™ì‘í•˜ë©´ GCë¥¼ ì œì™¸í•œ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë©ˆì¶”ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

Young ì˜ì—­ì˜ Minor GCëŠ” ê°ì²´ëŠ” ìˆ˜ëª…ì´ ì§§ê³  ë§ì€ ê°ì²´ë¥¼ ê²€ì‚¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì†ë„ê°€ ë§¤ìš° ë¹¨ë¼ ê±°ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ Major GCëŠ” ì‚´ì•„ ìˆëŠ” **ëª¨ë“  ê°ì²´ë¥¼ ê²€ì‚¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤.** Major GCê°€ ì¼ì–´ë‚˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— **Major GCê°€ ì¼ì–´ë‚˜ëŠ” íšŸìˆ˜ë¥¼ ìµœì†Œí™” í•´ì•¼ í•©ë‹ˆë‹¤.**  ë§Œì•½ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ Major GCê°€ ì¼ì–´ë‚˜ëŠ” íšŸìˆ˜ê°€ ë§ë‹¤ë©´ timeout ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.

GCê°€ ë™ì‘í•˜ëŠ” ì‹œê°„ì€ GCì˜ ì „ëµì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ê·¸ë˜ì„œ Stop the Worldë¥¼ ë°œìƒì‹œí‚¤ëŠ” íšŸìˆ˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œëŠ” GCë¥¼ ëª¨ë‹ˆí„°ë§ í•˜ì—¬ ì ì ˆí•˜ê²Œ íŠœë‹í•˜ëŠ” ìŠµê´€ì´ í•„ìš”í•©ë‹ˆë‹¤.

## Permanent ì˜ì—­ 

Permanent ì˜ì—­ì€ JVMì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìˆëŠ” **í´ë˜ìŠ¤ë“¤ê³¼ ë©”ì†Œë“œë“¤ì„ ì•Œê¸°ìœ„í•´ ë©”íƒ€ë°ì´í„°ë“¤**ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. **Permanent ì˜ì—­ì€ Heap ê³µê°„ì´ ì•„ë‹™ë‹ˆë‹¤.** 

Permanent ì˜ì—­ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë“¤ì„ ê¸°ì´ˆë¡œ JVMì´ ëŸ°íƒ€ì„ ì‹œ ìƒì„±í•©ë‹ˆë‹¤. ë˜í•œ Java SE ë¼ì´ë¸ŒëŸ¬ë¦¬ í´ë˜ìŠ¤ë“¤ê³¼ ë©”ì†Œë“œë“¤ì„ í¬í•¨í•˜ê³  ìˆìœ¼ë©°, Full GCì— ì˜í•´ GCê°€ ë©ë‹ˆë‹¤.

> Minor GC Vs Major GC Vs Full GC
>
> - Minor GC : Young ë¶€ë¶„
> - Major GC : Old ë¶€ë¶„
> - Full GC : Minor GC + Major GC

## Method Area

Method AreaëŠ” Permanent ì˜ì—­ì˜ í•œë¶€ë¶„ì´ë©° **í´ë˜ìŠ¤ êµ¬ì¡°(ëŸ°íƒ€ì„ ìƒìˆ˜ë‚˜, static ë³€ìˆ˜ë“¤)ì™€ ë©”ì†Œë“œì™€ ìƒì„±ì ì½”ë“œë¥¼ ì €ì¥**í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤. 

## Memory Pool

Memory Poolì€ ë³€ê²½ ë¶ˆê°€ëŠ¥ ê°ì²´ì˜ poolì„ ë§Œë“¤ê¸° ìœ„í•´ JVM ë©”ëª¨ë¦¬ ë§¤ë‹ˆì €ê°€ ë§Œë“­ë‹ˆë‹¤. String Poolì´ Memory poolì˜ ì¢‹ì€ ì˜ˆì œ ì¤‘ í•˜ë‚˜ ì…ë‹ˆë‹¤. **Memory Poolì€ JVM ë©”ëª¨ë¦¬ ê´€ë¦¬ êµ¬í˜„ì— ë”°ë¼ Heap ë˜ëŠ” Perm ì˜ì—­ì— ì¡´ì¬í•©ë‹ˆë‹¤.**

## ìë°” í™ ë©”ëª¨ë¦¬ ìŠ¤ìœ„ì¹˜

ìë°”ì—ì„œ ë©”ëª¨ë¦¬ ì‚¬ì´ì¦ˆì™€ ë¹„ìœ¨ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ìŠ¤ìœ„ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 

| VM Switch         | ì„¤ëª…                                                         |
| ----------------- | ------------------------------------------------------------ |
| -Xms              | JVMì´ ì‹œì‘í•  ë•Œ ì´ˆê¸° heap ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •                      |
| -Xmx              | heapì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •                                    |
| -Xmn              | Young ì˜ì—­ì˜ ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •í•œë‹¤. ë‚˜ë¨¸ì§€ëŠ” Old ì˜ì—­ì‚¬ì´ì¦ˆë¡œ ì„¤ì •ë¨. |
| -XX:PermGen       | Permanent ì˜ì—­ì˜ ì´ˆê¸° ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •                          |
| -XX:MaxPermGen    | Permanent ì˜ì—­ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •                          |
| -XX:SurvivorRatio | Eden ì˜ì—­ê³¼ , Survivor ì˜ì—­ì˜ ë¹„ìœ¨ì„ ì„¤ì •.<br /> ì˜ˆë¥¼ ë“¤ì–´ Young ì˜ì—­ì˜ ì‚¬ì´ì¦ˆê°€ 10m ì¸ë°, -XX:SurvivorRatio=2 ë¡œ ì„¤ì •í•˜ë©´<br />Eden ì˜ì—­ì—ëŠ” 5mê°€ ì„¤ì •ë˜ê³ , Survivor ì˜ì—­ì€ ê°ê° 2.5mì”© í• ë‹¹ë¨.<br />ê¸°ë³¸ê°’ì€ 8ì´ë‹¤. |
|                   |                                                              |

[JVM ì˜µì…˜ë“¤](https://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html)

## Garbage Collection(GC)

ìë°”ì˜ Garbage Collection(GC)ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê°ì²´ë¥¼ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°í•˜ëŠ” ê²ƒì´ ëª©ì  ì…ë‹ˆë‹¤. ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì¸ Cì–¸ì–´ ê°™ì€ê²½ìš° ë©”ëª¨ë¦¬ í• ë‹¹ê³¼ ì œê±°ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í•´ì¤˜ì•¼í•˜ì§€ë§Œ, ìë°”ëŠ” ìë™ìœ¼ë¡œ GCê°€ ì²˜ë¦¬í•´ì¤ë‹ˆë‹¤.

GCëŠ” í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ì— ë©”ëª¨ë¦¬ì•ˆì— ìˆëŠ” ëª¨ë“  ê°ì²´ë¥¼ ê²€ì‚¬í•˜ì—¬ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì„ ì°¾ì•„ë‚´ëŠ” ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ì°¸ì¡°ë¥¼ í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ê°ì²´ëŠ” ëª¨ë‘ ì‚­ì œë˜ë©° ì¶”í›„ì— ë‹¤ë¥¸ ê°ì²´ë¥¼ ìœ„í•´ í• ë‹¹ì„ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## GCì˜ ì¢…ë¥˜

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” GCì˜ ì¢…ë¥˜ëŠ” ì´ 5ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

1. **Serial GC(-XX:+UseSerialGC)** : Serial GCëŠ” Young(Minor GC)ê³¼ Old(Major GC)ì— mark-sweep-compact ë¼ëŠ” ë°©ë²•ì„ ì´ìš©í•©ë‹ˆë‹¤.  í´ë¼ì´ì–¸íŠ¸ì˜ ë¨¸ì‹ ì´ ë…ë¦½ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ê±°ë‚˜, CPU ì„±ëŠ¥ì´ ë‚®ì„ ë•Œ ìœ ìš©í•˜ë©° í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë©€í‹° í”„ë¡œì„¸ìŠ¤ í•˜ë“œì›¨ì–´ë¥¼ í™œìš©í•  ìˆ˜ ì—†ê³ , ë©€í‹° í”„ë¡œì„¸ì„œ í™˜ê²½ì—ì„œë„ ì†Œí˜• ë°ì´í„°ì…‹(ìµœëŒ€ 100MBì •ë„)ì„ ë‹¤ë£¨ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´ ì“¸ë§Œí•©ë‹ˆë‹¤.

   - Young GC ì•Œê³ ë¦¬ì¦˜ : Serial
   - Old GC ì•Œê³ ë¦¬ì¦˜ : Serial Mark-Sweep-Compact

2. **Parallel GC(-XX:+UseParallelGC)** :  Parallel GCëŠ” **ì‹œìŠ¤í…œì— ìˆëŠ” CPU ì½”ì–´ì˜ ìˆ˜ ë§Œí¼ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ì–´ Young(Minor GC)ì— ì´ìš©í•˜ëŠ” ê²ƒ**ì„ ì œì™¸í•˜ê³ ëŠ” Serial GCì™€ ê°™ìŠµë‹ˆë‹¤. `-XX:ParallelGCThreads=n ` JVM ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ ìŠ¤ë ˆë“œì˜ ìˆ˜ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Parallel GCëŠ” GC ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´ ì—¬ëŸ¬ CPUë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— throughput collectorë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤. **Parallel GCëŠ” Old(Major GC)ì—ì„œëŠ” í•œê°œì˜ ìŠ¤ë ˆë“œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.**

   - Young GC ì•Œê³ ë¦¬ì¦˜ : Parallel Scavenge
   - Old Gc ì•Œê³ ë¦¬ì¦˜ : Serial Mark-Sweep-Compact

3. **Parallel Old GC(-XX:+UseParallelOldGC)** : **Young(Minor GC)ì™€ Old(Major GC)ì—ì„œ ëª¨ë‘ ì—¬ëŸ¬ ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©**í•˜ëŠ” ê²ƒë§Œ ì œì™¸ í•˜ê³ ëŠ” Parallel GCì™€ ë™ì¼í•©ë‹ˆë‹¤.

4. **Concurrent Mark Sweep(CMS) Collector(-XX:+UseConcMarkSweepGC)** : CMS CollectorëŠ” Concurrent low pause collectorë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤. Old(Major GC)ì— ê´€ë ¨ëœ GCì…ë‹ˆë‹¤. **CMS CollectorëŠ” GC ì‘ì—…ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” ìŠ¤ë ˆë“œë¥¼ ë™ì‹œì— ìˆ˜í–‰í•˜ì—¬ Stop-The-World ë•Œë¬¸ì— ì¼ì–´ë‚˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ì§€ ìƒíƒœë¥¼ ìµœì†Œí™” í•©ë‹ˆë‹¤.** **Young ì˜ì—­ì—ì„œëŠ” Parallel Collectorì™€ ë˜‘ê°™ì€ ì•Œê³ ë¦¬ì¦˜**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ GCëŠ” GCë•Œë¬¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ì§€ë˜ëŠ” ì¼ì´ ì—†ì–´ì•¼ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. `-XX:ParallelCMSThreads=n` JVM ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ CMS collectorì˜ ìŠ¤ë ˆë“œ ìˆ˜ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   CMS GCëŠ” Stop-The-Worldë•Œë¬¸ì— ì¼ì–´ë‚˜ëŠ” ì¼ì‹œ ì •ì§€ ì‹œê°„ì„ ì¤„ì´ëŠ” ê²ƒì´ ëª©ì ì´ë©°, STWë•Œë¬¸ì— ì¼ì–´ë‚˜ëŠ” **ì¼ì‹œì •ì§€ë¥¼ í¬í•¨í•œ í‰ê·  ì‘ë‹µ ì‹œê°„ì„ ì¤„ì´ê³ ì** í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

   - Young GC ì•Œê³ ë¦¬ì¦˜ : Parallel
   - Old GC ì•Œê³ ë¦¬ì¦˜ : Concurrent Mark-Sweep

5. **G1 GC(-XX:UseG1GC)** : G1 GCëŠ” Java7 ì—ì„œë¶€í„° ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, CMS collectorë¥¼ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ ì£¼ëœ ëª©í‘œì…ë‹ˆë‹¤. G1 GCëŠ” ë³‘ë ¬ì„±, ë™ì‹œì„± , ì ì€ Stop-the-world ë¥¼ ê°€ì§„ GC ì…ë‹ˆë‹¤. G1 GCëŠ” ë‹¤ë¥¸ GCì™€ ë‹¤ë¥´ê²Œ **Young ì˜ì—­ê³¼ Old ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤.** í™ ê³µê°„ì„ ì—¬ëŸ¬ ê°œì˜ ë™ì¼í•œ ì‚¬ì´ì¦ˆì˜ í™ ê³µê°„ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ”ë° ë¶„ë¦¬ëœ ê³µê°„ì„ regionì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. GCê°€ í˜¸ì¶œë˜ë©´ region ì¤‘ì— livenessê°€ ê°€ì¥ ì ì€ ê³³ì´ GC ë©ë‹ˆë‹¤. 

   - Young GC ì•Œê³ ë¦¬ì¦˜ : Snapshot-At-The-Beginning(SATB)
   - Old GC ì•Œê³ ë¦¬ì¦˜ : Snapshot-At-The-Beginning(SATB)

    [Garbage-First Collector Oracle Documentation](https://docs.oracle.com/javase/7/docs/technotes/guides/vm/G1.html).

## GC ëª¨ë‹ˆí„°ë§ 

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ GC í™œë™ì„ ëª¨ë‹ˆí„°ë§ í•˜ê¸° ìœ„í•´ GUI ë˜ëŠ” CUIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

### jstat

JVM ë©”ëª¨ë¦¬ì™€ GCí™œë™ì„ ëª¨ë‹ˆí„°ë§ í•˜ê¸° ìœ„í•´ CUI ì—ì„œ jstatì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ JDKë¥¼ ì´ìš©í•˜ë¯€ë¡œ ì¶”ê°€ì‘ì—…ì€ ì—†ìŠµë‹ˆë‹¤.

ì•„ë¬´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ì‹¤í–‰ì‹œí‚¤ê³  ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ í•´ì£¼ì„¸ìš”.

> ì €ëŠ” í˜„ì¬ í”„ë¡œì íŠ¸ í•˜ê³  ìˆëŠ” outstagram-discovery.jar ì„ ì‹¤í–‰ì‹œì¼°ìŠµë‹ˆë‹¤.

```
$ java -Xmx120m -Xms30m -Xmn10m -XX:PermSize=20m -XX:MaxPermSize=20m -XX:+UseSerialGC -jar outstagram-discovery.jar
```

`jstat` ì„ ì‹¤í–‰í•˜ë ¤ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í”„ë¡œì„¸ìŠ¤ id**ë¥¼ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í„°ë¯¸ë„ì„ ì—´ê³  `ps -eaf | grep application.jar` ì„ ì…ë ¥í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

```
Donghyeonui-iMac:~ donghyeonmin$ ps -eaf | grep outstagram-discovery.jar
  501 32235 32069   0 11:29PM ttys008    0:20.42 /usr/bin/java -Xmx120m -Xms30m -Xmn10m -XX:PermSize=20m -XX:MaxPermSize=20m -XX:+UseSerialGC -jar outstagram-discovery.jar
  501 32331 32088   0 11:31PM ttys009    0:00.00 grep outstagram-discovery.jar
```

ì—¬ê¸°ì„œ í”„ë¡œì„¸ìŠ¤ idëŠ” 32235ì…ë‹ˆë‹¤. jstatì„ ì‹¤í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.

```
Donghyeonui-iMac:~ donghyeonmin$ jstat -gc 32235 1000
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT
1024.0 1024.0  0.0    0.0    8192.0   7933.3   42108.0    23401.3   20480.0 19990.9    157    0.274  40      1.381    1.654
1024.0 1024.0  0.0    0.0    8192.0   8026.5   42108.0    23401.3   20480.0 19990.9    157    0.274  40      1.381    1.654
1024.0 1024.0  0.0    0.0    8192.0   8030.0   42108.0    23401.3   20480.0 19990.9    157    0.274  40      1.381    1.654
1024.0 1024.0  0.0    0.0    8192.0   8122.2   42108.0    23401.3   20480.0 19990.9    157    0.274  40      1.381    1.654
1024.0 1024.0  0.0    0.0    8192.0   8171.2   42108.0    23401.3   20480.0 19990.9    157    0.274  40      1.381    1.654
1024.0 1024.0  48.7   0.0    8192.0   106.7    42108.0    23401.3   20480.0 19990.9    158    0.275  40      1.381    1.656
1024.0 1024.0  48.7   0.0    8192.0   145.8    42108.0    23401.3   20480.0 19990.9    158    0.275  40      1.381    1.656

```

ëª…ë ¹ì–´ì˜ ë§ˆì§€ë§‰ ì¸ìëŠ” GC ë°ì´í„°ë¥¼ ë§¤ë²ˆ 1ì´ˆë§ˆë‹¤ ì¶œë ¥í•˜ë¼ëŠ” ì¶œë ¥ì‹œê°„ì˜ ë³€ìˆ˜ ì…ë‹ˆë‹¤. 

ì»¬ëŸ¼í•˜ë‚˜ì”© í›‘ì–´ë³´ê² ìŠµë‹ˆë‹¤.

> ì‚¬ì´ì¦ˆëŠ” KB(í‚¬ë¡œë°”ì´íŠ¸)ê°€ ê¸°ë³¸ì…ë‹ˆë‹¤.

- **S0C ì™€ S1C** : Survivor0ê³¼ Survivor1 ì˜ì—­ì˜ ì‚¬ì´ì¦ˆ ì…ë‹ˆë‹¤.
- **S0U ì™€ S1U** : Survivor0ê³¼ Survivor1 ì˜ì—­ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì‚¬ì´ì¦ˆ ì…ë‹ˆë‹¤. ë‘˜ì¤‘ í•˜ë‚˜ëŠ” í•­ìƒ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.
- **EC ì™€ EU** : ECëŠ” Eden ì˜ì—­ì˜ ì‚¬ì´ì¦ˆë¥¼ ë§í•©ë‹ˆë‹¤.EUëŠ” Edenì˜ ì‚¬ìš©ëŸ‰ì„ ë§í•©ë‹ˆë‹¤. ìœ„ì—ë¥¼ ë³´ë©´ EU ì‚¬ì´ì¦ˆê°€ ê³„ì† ì¦ê°€í•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆëŠ”ë°, Minor GCê°€ ë™ì‘í•˜ë©´ ë‹¤ì‹œ ì‚¬ì´ì¦ˆê°€ ì¤„ì–´ë“­ë‹ˆë‹¤.
- **OC ì™€ OU** : OCëŠ” Old ì˜ì—­ì˜ ì‚¬ì´ì¦ˆë¥¼ ë§í•©ë‹ˆë‹¤. OUëŠ” Old ì˜ì—­ì˜ ì‚¬ìš©ë¥  ì…ë‹ˆë‹¤.
- **PC ì™€ PU** : PCëŠ” Permanent ì˜ì—­ì˜ ì‚¬ì´ì¦ˆë¥¼ ë§í•©ë‹ˆë‹¤. PUëŠ” Permanent ì˜ì—­ì˜ ì‚¬ìš©ë¥  ì…ë‹ˆë‹¤. 
- **YGCì™€ YGCT** : YGCëŠ” young ì˜ì—­ ì•ˆì— GCê°€ ì–¼ë§ˆí¼ ì¼ì–´ë‚¬ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. YGCTëŠ” Young ì˜ì—­ì•ˆì—ì„œ GCê°€ ê±¸ë¦¬ì‹œê°„ì˜ ëˆ„ì ì‹œê°„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. EUì˜ ê°’ì´ ì¤„ì–´ë“¤ ë•Œ ë°”ë¡œ Minor GCê°€ ë°œìƒí–ˆê¸° ë•Œë¬¸ì—, ê·¸ ë¶€ë¶„ì„ ë³´ì‹œë©´ EU ê°’ì€ ì¤„ê³  YGCì™€ YGCTëŠ” ê°’ì´ ëŠ˜ì–´ë‚¬ìŠµë‹ˆë‹¤.
- **FGC and FGCT** : FGCëŠ” Full GCê°€ ëª‡ ë²ˆ ì¼ì–´ë‚¬ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. FGCTëŠ” Full GCê°€ ê±¸ë¦° ì‹œê°„ì˜ ëˆ„ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. 
- **GCT** : ëª¨ë“  GCê°€ ê±¸ë¦° ëˆ„ì  ì‹œê°„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. YGCTì™€ FGCTì˜ í•©ì…ë‹ˆë‹¤.

jstatì€ GUIë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šì€ ì›ê²© ì„œë²„ì—ì„œ ì‹¤í–‰í•˜ê¸°ì— ì¢‹ìŠµë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ë•Œ `-Xmn10m` ì„ ì£¼ì–´ Youngì˜ì—­ì˜ ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— S0C , S1C , ECì˜ í•©ì€ 10m ì…ë‹ˆë‹¤.



### Java VisualVM with Visual GC

ë§Œì•½ GUIë¡œ ë©”ëª¨ë¦¬ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´ jvisualvm íˆ´ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

[VisualVM](https://visualvm.github.io/)

VisualVM ì„¤ì¹˜í›„ Tool -> pluginì— ë“¤ì–´ê°€ì„œ Visual GCë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

![](https://github.com/DaeAkin/DaeAkin.github.io/blob/master/img/gc/visualVM2.png?raw=true)



![](https://github.com/DaeAkin/DaeAkin.github.io/blob/master/img/gc/visualVM.png?raw=true)

ì´ë ‡ê²Œ GUIë¡œ ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

## GC íŠœë‹ 

GCíŠœë‹ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì²˜ë¦¬ëŸ‰ì„ ì˜¬ë¦¬ê±°ë‚˜ GCì˜ ì‹œê°„ì´ ê¸¸ì–´ timeoutì´ ë°œìƒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ìµœí›„ì˜ ë³´ë£¨ë¡œ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.

ë§Œì•½ `java.lang.OutOfMemoryError: PermGen space` ì—ëŸ¬ë¥¼ ë³¸ë‹¤ë©´ Permanent ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ -XX:PermGen ê³¼ -XX:MAXPermGENì„ ì´ìš©í•´ì„œ ëŠ˜ë¦¬ë©´ ë©ë‹ˆë‹¤. 

ë§Œì•½ Full GCê°€ ë§ì•„ì§„ë‹¤ë©´ Old ì˜ì—­ì˜ ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ë©´ ë©ë‹ˆë‹¤.

ì „ë°˜ì ì¸ GC íŠœë‹ì€ ë§ì€ ë…¸ë ¥ê³¼ ì‹œê°„ì´ í•„ìš”í•˜ë©°, ê·¸ê²ƒì— ëŒ€í•œ ì •í™•í•œ ë‹µì€ ì—†ìŠµë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê°€ì¥ ì•Œë§ì€ ì˜µì…˜ì„ ì°¾ëŠ” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.

- [JDK 12 Garbage Collection Tuning Guide](https://docs.oracle.com/en/java/javase/12/gctuning/introduction-garbage-collection-tuning.html)
- [JDK 11 Garbage Collection Tuning Guide](https://docs.oracle.com/en/java/javase/11/gctuning/introduction-garbage-collection-tuning.html)
- [JDK 10 Garbage Collection Tuning Guide](https://docs.oracle.com/javase/10/gctuning/introduction-garbage-collection-tuning.htm)
- [JDK 9 Garbage Collection Tuning Guide](https://docs.oracle.com/javase/9/gctuning/introduction-garbage-collection-tuning.htm)
- [JDK 8 Garbage Collection Tuning Guide](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/)

## ë§ˆì¹˜ë©°

ë§Œì•½ ì‘ë‹µì‹œê°„ì´ ì „ì²´ ì²˜ë¦¬ëŸ‰ë³´ë‹¤ ì¤‘ìš”ì‹œ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´  CMS GCë¥¼ ì„ íƒí•´ë³¼ë§Œ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•­ìƒ ì–´ë–¤ GCë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆê¹Œ? ì— ë‹µì€ ì—†ìŠµë‹ˆë‹¤. í•˜ë“œì›¨ì–´ì— ë”°ë¼ ë‹¤ë¥´ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë§ˆë‹¤ ë‹¤ë¥¸ GCê°€ ìµœì ì˜ ë°©ë²•ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ê°œë°œìê°€ ì»¬ë ‰í„°ë¥¼ ë°”ê¿”ê°€ë©´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ê³  ê·¸ì— ë§ê²Œ Heap ì‚¬ì´ì¦ˆë„ ì¡°ì ˆë„ í•´ë´ì•¼ í•©ë‹ˆë‹¤.



