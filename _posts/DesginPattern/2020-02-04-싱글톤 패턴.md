---
layout: post
title: ì‹±ê¸€í†¤ íŒ¨í„´
categories: [Design Pattern]
comments: true 
tags:
- Design Pattern
---
# ì‹±ê¸€í†¤ íŒ¨í„´ 

ì‹±ê¸€í†¤ íŒ¨í„´ì€ **Gangs Of Four(GOF)** ë””ìì¸ íŒ¨í„´ ì¤‘ í•œê°œì´ë©° **ê°ì²´ ìƒì„±í•  ë•Œ ì“°ëŠ” ë””ìì¸ íŒ¨í„´**ì…ë‹ˆë‹¤. ì‹±ê¸€í†¤ì˜ ì •ì˜ë¥¼ ë“¤ì—¬ë‹¤ë³´ë©´ ì—„ì²­ ê°„ë‹¨í•œ ë””ìì¸ íŒ¨í„´ì¸ ê²ƒ ê°™ì§€ë§Œ ì‹¤ì œë¡œ êµ¬í˜„ì„ í•´ë³´ë©´ ì‹ ê²½ì„ ë§ì´ ì¨ì•¼í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

ìë°”ì˜ ì‹±ê¸€í†¤ íŒ¨í„´ì˜ êµ¬í˜„ì€ ê°œë°œìë“¤ ì‚¬ì´ì—ì„œ í•­ìƒ ë…¼ë€ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì‹±ê¸€í†¤ ë””ìì¸ íŒ¨í„´ ê·œì¹™ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³ , ë‹¤ë¥¸ ë°©ë²•ì˜ ì‹±ê¸€í†¤ ë””ìì¸íŒ¨í„´ì˜ êµ¬í˜„ì™€ ì ì ˆí•œ ì˜ˆë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

í•´ë‹¹ ì˜ˆì œ ì†ŒìŠ¤ëŠ” [github](https://github.com/DaeAkin/java-design-pattern/tree/master/src/main/java/com/donghyeon/designpattern/singleton)ì—ì„œ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‹±ê¸€í†¤ íŒ¨í„´ 

- ì‹±ê¸€í†¤ íŒ¨í„´ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤í™”ë¥¼ ì–µì œí•˜ê³  **ì˜¤ì§ í•œê°œì˜ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤**ë§Œ ìë°” ê°€ìƒë¨¸ì‹ ì— ì¡´ì¬í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.
- ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë°˜ë“œì‹œ ì–´ë””ì„œë“  í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **ê¸€ë¡œë²Œí•˜ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ì§€ì **ì„ ì œê³µí•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
- ì‹±ê¸€í†¤ íŒ¨í„´ì€ ë¡œê¹…ì´ë‚˜, ë“œë¼ì´ë²„ ì˜¤ë¸Œì íŠ¸, ìºì‹±, ê·¸ë¦¬ê³  ìŠ¤ë ˆë“œ í’€ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
- ì‹±ê¸€í†¤ íŒ¨í„´ì€ ì¶”ìƒ íŒ©í† ë¦¬ íŒ¨í„´ì´ë‚˜ ë¹Œë” íŒ¨í„´ ë“± ë‹¤ë¥¸ íŒ¨í„´ë“¤ì´ ì‚¬ìš©í•˜ê¸°ë„ í•©ë‹ˆë‹¤.
- ì‹±ê¸€í†¤ íŒ¨í„´ì€ ìë°”ì˜ ì½”ì–´ í´ë˜ìŠ¤ì¸ java.lang.RunTime ì´ ì‚¬ìš©í•˜ê³  ìˆëŠ” íŒ¨í„´ì´ê¸°ë„ í•©ë‹ˆë‹¤.

## ì‹±ê¸€í†¤ íŒ¨í„´ êµ¬í˜„í•˜ê¸°

ì‹±ê¸€íŒ¨í†¤ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ì„œ ê°ê¸°ë‹¤ë¥¸ ì ‘ê·¼ë²•ì„ ì‚¬ìš©í•˜ì§€ë§Œ , ë‹¤ìŒì˜ ê³µí†µ ì»¨ì…‰ì€ ë™ì¼í•©ë‹ˆë‹¤. 

- ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ”ê±¸ ë§‰ê¸°ìœ„í•´ **ìƒì„±ìë¥¼ private ì²˜ë¦¬**í•´ì¤ë‹ˆë‹¤. 
- ì˜¤ì§ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°–ê¸° ìœ„í•´ì„œ **private static ë³€ìˆ˜**ë¥¼ í•´ë‹¹ í´ë˜ìŠ¤ì— ì„ ì–¸í•©ë‹ˆë‹¤. 
- **í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ë¦¬í„´í•˜ëŠ” public static ë©”ì†Œë“œ**ë¥¼ ë§Œë“­ë‹ˆë‹¤. ì´ ë©”ì†Œë“œê°€ ë°”ë¡œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œë„ ê¸€ë¡œë²Œí•˜ê²Œ ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆëŠ” ì—­í• ì„ í•´ì£¼ëŠ” í´ë˜ìŠ¤ ì…ë‹ˆë‹¤. 

ì´ì œ ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. 

### ì¦‰ì‹œ ì´ˆê¸°í™”(Eager initialization)

ì¦‰ì‹œ ì´ˆê¸°í™” í•˜ëŠ” ë°©ë²•ì€ í´ë˜ìŠ¤ê°€ ë¡œë”©í•˜ëŠ” ì‹œì ì— í´ë˜ìŠ¤ê°€ ë§Œë“¤ì–´ ì§‘ë‹ˆë‹¤. ì´ ë°©ë²•ì´ ì‹±ê¸€í†¤ì„ ë§Œë“œëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì´ì§€ë§Œ ì´ í´ë˜ìŠ¤ê°€ ì‚¬ìš©ì„ ì•ˆí•  ìˆ˜ë„ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“ ë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.(ìì›ë‚­ë¹„ê°€ ë˜ê² ì£ ?)  

ë‹¤ìŒì€ ì¦‰ì‹œ ì´ˆê¸°í™”ì˜ ì˜ˆì œ ì…ë‹ˆë‹¤.

```java
public class EagerInitializationSingleton {

    private static final EagerInitializationSingleton instance = new EagerInitializationSingleton();

    private EagerInitializationSingleton() {
    }

    public static EagerInitializationSingleton getInstance() {
        return instance;
    }
}
```

ë§Œì•½ í´ë˜ìŠ¤ ì•ˆì— **ë¦¬ì†ŒìŠ¤ë“¤ì´ ë§ì§€ ì•Šë‹¤ë©´ ìì›ë‚­ë¹„ê°€ ì‹¬í•˜ì§„ ì•Šìœ¼ë¯€ë¡œ** ì´ ë°©ë²•ì„ ì‚¬ìš©í•´ë„ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë§ì€ ì‹œë‚˜ë¦¬ì˜¤ë“¤ì´ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ë¥¼ íŒŒì¼ ì‹œìŠ¤í…œì´ë‚˜, ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ë“± ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡ì•„ ë¨¹ëŠ” í´ë˜ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤. ë§Œì•½ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì´ëŸ° ë¦¬ì†ŒìŠ¤ë“¤ì„ ë‚­ë¹„í•˜ê¸° ë•Œë¬¸ì— getInstance() ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ê¸° ì „ê¹Œì§€ëŠ” í´ë˜ìŠ¤ ë§Œë“œëŠ” ì‘ì—…ì„ í•˜ì§€ ì•ŠëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë˜í•œ ì´ ë°©ë²•ì€ **Exceptionì„ í•¸ë“¤ë§ í•  ë°©ë²•**ì´ ì—†ìŠµë‹ˆë‹¤.

### Static blockë¥¼ ì´ìš©í•œ ì´ˆê¸°í™”(Static block initialization)

Static block ì´ˆê¸°í™” êµ¬í˜„ì€ **static blockì„ ì´ìš©í•´ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“ ë‹¤ëŠ” ì **ì„ ë¹¼ê³ ëŠ” ìœ„ì— ìˆëŠ” ì¦‰ì‹œ ì´ˆê¸°í™”ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ **Excpetion í•¸ë“¤ë§ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.**

```java
public class StaticBlockSingleton {
    private static StaticBlockSingleton instance;

    private StaticBlockSingleton() {
    }
    //static block initialization for exception handling
    static{
        try{
            instance = new StaticBlockSingleton();
        }catch(Exception e){
            throw new RuntimeException("Exception occured in creating singleton instance");
        }
    }

    public static StaticBlockSingleton getInstance() {
        return instance;
    }
}
```

Static blockì„ ì´ìš©í•œ ì´ˆê¸°í™”ì™€ ì¦‰ì‹œ ì´ˆê¸°í™” ëª¨ë‘ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë²„ë¦¬ë¯€ë¡œ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ê¸°ì—” íš¨ê³¼ì ì¸ ë°©ë²•ì€ ì•„ë‹™ë‹ˆë‹¤. 

### ì§€ì—° ì´ˆê¸°í™”(Lazy initialization)

```java
public class LazyInitialization {
    private static LazyInitialization instance;

    private LazyInitialization() {
    }

    public static LazyInitialization getInstance() {
        if(instance == null) {
            instance = new LazyInitialization();
        }
        return instance;
    }
}
```

ì´ ë°©ë²•ì€ ì‹±ê¸€ìŠ¤ë ˆë“œ ê¸°ë°˜ í™˜ê²½ì—ì„œëŠ” ì˜ ì‘ë™í•˜ì§€ë§Œ, RXê°™ì€ ë©€í‹°ìŠ¤ë ˆë“œ ì‹œìŠ¤í…œê²½ìš° **if ë¬¸ì„ ë™ì‹œì— ì‹¤í–‰í•˜ë©´** ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. 

### ìŠ¤ë ˆë“œì„¸ì´í”„í•œ ì‹±ê¸€í†¤(Thread Safe Singleton)

ìŠ¤ë ˆë“œ ì„¸ì´í”„í•œ ì‹±ê¸€í†¤ì„ ë§Œë“¤ê¸° ì‰¬ìš´ ë°©ë²•ì€ getInstance() ë©”ì†Œë“œì—  synchronizedë¥¼ ë¶™ì—¬ì¤˜ì„œ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œì”© ì‹¤í–‰ë˜ê²Œ í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. 

```java
public class ThreadSafeSingleton {
    private static ThreadSafeSingleton instance;

    private ThreadSafeSingleton() {
    }
    public static synchronized ThreadSafeSingleton getInstance() {
        if(instance == null) {
            return new ThreadSafeSingleton();
        }
        return instance;
    }
}
```

ìœ„ì— ìˆëŠ” ì½”ë“œëŠ” ìŠ¤ë ˆë“œ ì„¸ì´í”„í•˜ì§€ë§Œ, synchronized ë©”ì†Œë“œì´ê¸° ë•Œë¬¸ì— **ì„±ëŠ¥ì„ ì €í•˜** ì‹œí‚µë‹ˆë‹¤.

ì´ëŸ° ì˜¤ë²„í—¤ë“œë¥¼ í”¼í•˜ê¸° ìœ„í•´ì„ , **double checked locking** ê·œì¹™ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ì ‘ê·¼ë²•ì€ í•œê°œì˜ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ê°€ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•˜ëŠ” if ì¡°ê±´ë¬¸ì´ synchronized blockì— ì‚¬ìš©ë©ë‹ˆë‹¤. 

```java
//ì´ ë©”ì†Œë“œë§Œ ë” ì¶”ê°€
public static ThreadSafeSingleton getInstanceUsingDoubleLocking() {
    if (instance == null) {
        synchronized (ThreadSafeSingleton.class) {
            if (instance == null) {
                instance = new ThreadSafeSingleton();
            }
        }
    }
    return instance;
}
```

### ğŸ‘ Bill Pugh ì‹±ê¸€í†¤ <- ì¶”ì²œ

ìë°”5 ì´ì „ì—ëŠ” ìë°” ë©”ëª¨ë¦¬ ëª¨ë¸ì€ ë§ì€ ì´ìŠˆê°€ ìˆì—ˆê³  ìœ„ì— ìˆëŠ” ë°©ë²•ì€ ë™ì‹œì— ë§ì€ ìŠ¤ë ˆë“œë“¤ì´ ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì ¸ì˜¬ë•Œ ì‹¤íŒ¨ë¥¼ í–ˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ **ë¹Œí‘¸(Bill Pugh)ëŠ” inner static helper í´ë˜ìŠ¤**ë¥¼ ì´ìš©í•´ ë‹¤ë¥¸ ë°©ë²•ì„ ìƒê°í–ˆìŠµë‹ˆë‹¤. 

```java
public class BillPughSingleton {

    private BillPughSingleton(){}
    
    private static class SingletonHelper{
        private static final BillPughSingleton INSTANCE = new BillPughSingleton();
    }
    
    public static BillPughSingleton getInstance(){
        return SingletonHelper.INSTANCE;
    }
}
```

ì—¬ê¸°ì„œ **private inner static inner í´ë˜ìŠ¤ê°€ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ê°–ìŠµë‹ˆë‹¤. ì‹±ê¸€í†¤ í´ë˜ìŠ¤ê°€ ë¡œë”©ì´ ë˜ë©´ `SingletonHepler` í´ë˜ìŠ¤ëŠ” ëˆ„êµ°ê°€ *getInstance()* ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— ë©”ëª¨ë¦¬ì— ì‹±ê¸€í†¤ í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤. 

ì´ **ë°©ë²•ì€ ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” ì‹±ê¸€í†¤ êµ¬í˜„ ë°©ë²•**ì´ë©°, ìŠ¤ë ˆë“œì„¸ì´í”„ í•©ë‹ˆë‹¤.  

> ì›”ë¦¬ì—„ í‘¸
>
> William Worthington Pugh Jr.ëŠ” Presburger ì‚°ìˆ  ê²°ì •ì„ìœ„í•œ ê±´ë„ˆ ë›°ê¸° ëª©ë¡ê³¼ Omega í…ŒìŠ¤íŠ¸ë¥¼ ë°œëª… í•œ ë¯¸êµ­ ì»´í“¨í„° ê³¼í•™ìì…ë‹ˆë‹¤. ì •ì  ì½”ë“œ ë¶„ì„ ë„êµ¬ ì¸ FindBugsì˜ ê³µë™ ì €ìì˜€ìœ¼ë©° í˜„ì¬ Java ì–¸ì–´ì˜ ë©”ëª¨ë¦¬ ëª¨ë¸ ê°œë°œì— í° ì˜í–¥ì„ ë¯¸ì³¤ìŠµë‹ˆë‹¤.

### ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ë§ê°€ëœ¨ë¦°ë‹¤.

```java
public class ReflectionSingletonTest {

    public static void main(String[] args) {
        EagerInitializationSingleton instanceOne = EagerInitializationSingleton.getInstance();
        EagerInitializationSingleton instanceTwo = null;
        try {
            Constructor[] constructors = EagerInitializationSingleton.class.getDeclaredConstructors();
            for (Constructor constructor : constructors) {
                //Below code will destroy the singleton pattern
                constructor.setAccessible(true);
                instanceTwo = (EagerInitializationSingleton) constructor.newInstance();
                break;
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        System.out.println("instanceOne : " + instanceOne.hashCode());
        System.out.println("instanceTWO : " +instanceTwo.hashCode());
    }

}
```

**ê²°ê³¼**

```java
instanceOne : 1829164700
instanceTWO : 2018699554
```

ìœ„ì— ì½”ë“œë¥¼ ì‹¤í–‰í•´ë³´ë©´ í•´ì‰¬ì½”ë“œ ê°’ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ë‹Œê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ë¦¬í”Œë ‰ì…˜ì€ ìŠ¤í”„ë§ì´ë‚˜ í•˜ì´ë²„ë„¤ì´íŠ¸ê°™ì€ ë§ì€ í”„ë ˆì„ì›Œí¬ë“¤ì´ ì“°ê³  ìˆìŠµë‹ˆë‹¤.