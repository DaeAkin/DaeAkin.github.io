---
layout: post
title: private ìƒì„±ìë‚˜ ì—´ê±° íƒ€ì…ìœ¼ë¡œ ì‹±ê¸€í„´ì„ì„ ë³´ì¥í•˜ê¸°
comments: true 
tags:
- ì´í™í‹°ë¸Œìë°”
---



[ì‹±ê¸€í„´](https://donghyeon.dev/design%20pattern/2020/02/04/%EC%8B%B1%EA%B8%80%ED%86%A4-%ED%8C%A8%ED%84%B4/)ì´ë€ ê°ì²´ë¥¼ ì˜¤ì§ í•˜ë‚˜ë§Œ ìƒì„±í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ë¥¼ ë§í•œë‹¤. ê·¸ëŸ°ë° **í´ë˜ìŠ¤ë¥¼ ì‹±ê¸€í„´ìœ¼ë¡œ ë§Œë“¤ë©´ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸°ê°€ ì–´ë ¤ì›Œ ì§ˆ ìˆ˜ ìˆë‹¤.**

## ì‹±ê¸€í„´ì„ ë§Œë“œëŠ” ë°©ë²•

ì‹±ê¸€í„´ì„ ë§Œë“œëŠ” ë°©ë²•ì€ ë³´í†µ ë‘˜ ì¤‘ í•˜ë‚˜ì´ë‹¤. ë‘ ë°©ì‹ ëª¨ë‘ ìƒì„±ìëŠ” ì™¸ë¶€ì—ì„œ í˜¸ì¶œì„ ëª»í•˜ë„ë¡ privateìœ¼ë¡œ ë§‰ì•„ë†“ê³ , public static ë©¤ë²„ë¡œ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜, ì•„ë‹ˆë©´ ë©”ì†Œë“œë¡œ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ë²•ì´ë‹¤.

### public static final í•„ë“œ ë°©ì‹ì˜ ì‹±ê¸€í„´

```java
public class Elvis {
  public static final Elvis INSTANCE = new Elvis();
  private Evlis() {}
}
```

private ìƒì„±ìëŠ” public static final í•„ë“œì¸ Elvis.INSTANCEë¥¼ ì´ˆê¸°í™” í•  ë•Œ ë”± í•œë²ˆ í˜¸ì¶œ ëœë‹¤. ê·¸ ì™¸ì— publicì´ë‚˜ protected ìƒì„±ìê°€ ì—†ìœ¼ë¯€ë¡œ Elvis ê°ì²´ëŠ” ì‹œìŠ¤í…œì—ì„œ ì˜¤ì§ í•˜ë‚˜ë¿ì„ì„ ë³´ì¥í•œë‹¤.



### ì •ì  íŒ©í„°ë¦¬ ë°©ì‹ì˜ ì‹±ê¸€í„´

```java
public class Elvis {
  private static final Elvis INSTANCE = new Elvis();
  private Elvis() {}
  public static Elvis getInstance() {return INSTANCE;}
}
```

ì •ì  íŒ©í„°ë¦¬ ë°©ì‹ë„ í•„ë“œ ë°©ì‹ì˜ ì‹±ê¸€í„´ê³¼ ê°™ì´ Elvis ê°ì²´ê°€ ì‹œìŠ¤í…œì— ì˜¤ì§ í•˜ë‚˜ë¿ì„ì„ ë³´ì¥í•œë‹¤.

### ë‘˜ì˜ ì°¨ì´ì ì€?

ì •ì  íŒ©í„°ë¦¬ ë°©ì‹ì˜ ì¥ì ì€ APIë¥¼ ë°”ê¾¸ì§€ ì•Šê³ ë„ ì‹±ê¸€í„´ì´ ì•„ë‹ˆê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤. í”„ë¡œê·¸ë˜ë¨¸ê°€ ì›í•˜ë©´ ì‹±ê¸€í„´ ë°©ì‹ì˜ ì •ì±…ì„ ê³ ìˆ˜í•˜ì§€ ì•Šê³ , ë§¤ë²ˆ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ë‚´ë¶€êµ¬í˜„ì„ ì‰½ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. 

ë˜ ë‹¤ë¥¸ ì •ì  íŒ©í„°ë¦¬ ë°©ì‹ì˜ ì¥ì ì€ ë‹¤ìŒê³¼ ê°™ì´ ì œë„ˆë¦­ ì‹±ê¸€í„´ íŒ©í„°ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

**ì œë„ˆë¦­ ì‹±ê¸€í„´ íŒ©í„°ë¦¬**

```java
public class SingletonFactory {
    public static Map<String,Object> objectFactory = new HashMap<String, Object>();

    public static <T> T getInstance(Class<T> c){
        synchronized (c) {
            String key = c.toString();
            Object instance= objectFactory.get(key);
            if (instance == null) {
                try {
                    instance = c.getInstance();
                    objectFactory.put(key, instance);
                } catch(IllegalAccessException | InstantiationException e){
                    throw new RuntimeException("Exception while creating singleton instance for class : "+key+" - Exception Message : "+e);
                }
            }
            return c.cast(instance);
            // or
            return (T) instance;
        }
    }
}
```

ê·¸ë¦¬ê³  ì •ì íŒ©í„°ë¦¬ì˜ ë©”ì„œë“œ ì°¸ì¡°ë¥¼ ê³µê¸‰ì(supplier)ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì € ã…ì´ë‹¤. ê°€ë ¹ `Elvis::getInstance` ë¥¼ `Supplier<Elvis>` ë¡œ ì‚¬ìš©í•˜ëŠ” ì‹ì´ë‹¤.

ì´ëŸ¬í•œ ì¥ì ë“¤ì´ êµ³ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ public í•„ë“œ ë°©ì‹ì´ ê¹”ë”í•˜ê³  ì¢‹ì€ ê²ƒ ê°™ë‹¤.

## ë¬¸ì œì ì€ ë­ê°€ ìˆì„ê¹Œ?

ì‹±ê¸€í„´ì´ë¼ê³  í•˜ë©´, ë°˜ë“œì‹œ ì´ ê°ì²´ëŠ” í”„ë¡œê·¸ë¨ ë‚´ì— ì˜¤ì§ í•˜ë‚˜ë§Œ ì¡´ì¬í•´ì•¼í•œë‹¤. ì–´ë– í•œ ì´ìœ ë¡œ ê°ì²´ê°€ í•˜ë‚˜ ë” ìƒê¸°ë©´ ì•ˆëœë‹¤.

ê·¸ëŸ¬ë‚˜ ì§ë ¬í™”í•˜ê³  ë‹¤ì‹œ ì—­ì§ë ¬í™”ë¥¼ í•˜ê²Œ ë˜ë©´ ìƒˆë¡œìš´ ê°ì²´ê°€ ìƒì„±ë˜ê²Œ ëœë‹¤. ì´ëŸ° ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ readResolve() í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ ëœë‹¤.

```java
//ì‹±ê¸€í„´ì„ì„ ë³´ì¥í•´ì£¼ëŠ” readResolve ë©”ì„œë“œ
private Object readResolve() {
  // ì§„ì§œ Elvisë¥¼ ë°˜í™˜í•˜ê³  ê°€ì§œ ElvisëŠ” GCì—ê²Œ ë§¡ê¸´ë‹¤.
  return INSTANCE;
}
```

ì‹¤ì œë¡œ ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™”ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì§œë³´ì•˜ë‹¤.

ë¨¼ì € readObject() ê°€ ì—†ìœ¼ë©´ ì–´ë–¤ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë´¤ë‹¤.

**Singleton.java**

```java
public class Singleton implements Serializable {

    private static Singleton instance = new Singleton();
    private int i;

    public static Singleton getInstance() {
        return instance;
    }

    private Singleton() { }
    
    public static void main(String[] args) throws Throwable {
        Singleton s = Singleton.getInstance();
        s.i = 5;

        System.out.println("ì§ë ¬í™” ì „ ::"+s.i+" "+ s);
        ByteArrayOutputStream baos = new java.io.ByteArrayOutputStream();
        ObjectOutputStream oos = new java.io.ObjectOutputStream(baos);
        oos.writeObject(getInstance());
        oos.close();

        s.i = 7;
        InputStream is = new ByteArrayInputStream(baos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(is);
        Singleton deserialized = (Singleton) ois.readObject();
        System.out.println("ì—­ì§ë ¬í™” í›„::"+deserialized.i+" "+deserialized);
    }
}
```

**Output**

```java
ì§ë ¬í™” ì „ ::5 Singleton@6d06d69c
ì—­ì§ë ¬í™” í›„::5 Singleton@776ec8df
```

ì½˜ì†”ì— ì°íŒê²ƒ ê³¼ ê°™ì´, ê°ì²´ê°€ ë‘ê°œê°€ ìƒê²¼ë‹¤. ì‹±ê¸€í„´ì„ ìœ„ë°˜í•œ ê²ƒì´ë‹¤.

ê·¸ë ‡ë‹¤ë©´ readResolve() í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

**Singleton.java (readResolve() í•¨ìˆ˜ê°€ ìˆëŠ”)**

```java
public class Singleton implements Serializable {

    private static Singleton instance = new Singleton();
    private int i;

    public static Singleton getInstance() {
        return instance;
    }

    private Singleton()  }

    private Object readResolve() {
        System.out.println("Executing readResolve");
        return instance;
    }
    public static void main(String[] args) throws Throwable {
        Singleton s = Singleton.getInstance();
        s.i = 5;

        System.out.println("ì§ë ¬í™” ì „ ::"+s.i+" "+ s);
        ByteArrayOutputStream baos = new java.io.ByteArrayOutputStream();
        ObjectOutputStream oos = new java.io.ObjectOutputStream(baos);
        oos.writeObject(getInstance());
        oos.close();

        s.i = 7;
        InputStream is = new ByteArrayInputStream(baos.toByteArray());
        ObjectInputStream ois = new ObjectInputStream(is);
        Singleton deserialized = (Singleton) ois.readObject();
        System.out.println("ì—­ì§ë ¬í™” í›„::"+deserialized.i+" "+deserialized);
    }
}
```

**Output**

```java
ì§ë ¬í™” ì „ ::5 Singleton@6d06d69c
Executing readResolve
ì—­ì§ë ¬í™” í›„::7 Singleton@6d06d69c
```

ì´ì „ê³¼ ë‹¤ë¥´ê²Œ ì—­ì§ë ¬í™”ë¥¼ í•œ í›„ ê°™ì€ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

ê·¸ëŸ°ë° ì—­ì§ë ¬í™”ë¥¼ ë””ë²„ê¹… í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¦¬í”Œë ‰ì…˜ì„ ì‚¬ìš©í•´ì„œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“ ë‹¤. ê·¸ëŸ¼ ì´ ê°ì²´ëŠ” ì–´ë–»ê²Œ ë ê¹Œ?

![ì§ë ¬í™”ë§ˆìƒ¬ë§êµì§‘í•©ì‚¬ì§„]({{site.url}}/images/unserDebug.png)

ë§Œë“¤ì–´ì§„ ê°ì²´ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì— ì˜í•´ì„œ ì‚¬ë¼ì§€ê²Œ ëœë‹¤.



## ğŸ‘Š ì—´ê±° íƒ€ì… ë°©ì‹ì˜ ì‹±ê¸€í„´ - ë˜ë‹¤ë¥¸ ë°©ë²• 

```java
public enum Elvis {
  INSTNACE;
  
  public void doSomething() {...}
}
```

public í•„ë“œ ë°©ì‹ê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ, ë” ê°„ê²°í•˜ê³ , ì¶”ê°€ ë…¸ë ¥ ì—†ì´ ì§ë ¬í™”í•  ìˆ˜ ìˆê³ , ì‹¬ì§€ê±° ì•„ì£¼ ë³µì¡í•œ ì§ë ¬í™” ìƒí™©ì‰ë‚˜ ë¦¬í”Œë ‰ì…˜ ê³µê²©ì—ì„œë„ ì œ 2ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒê¸°ëŠ” ì¼ì„ ì™„ë²½íˆ ë§‰ì•„ì¤€ë‹¤. ì¡°ê¸ˆ ë¶€ìì—°ìŠ¤ëŸ¬ì›Œ ë³´ì¼ ìˆ˜ëŠ” ìˆìœ¼ë‚˜ ëŒ€ë¶€ë¶„ ìƒí™©ì—ì„œ ì›ì†Œê°€ í•˜ë‚˜ë¿ì¸ ì—´ê±° íƒ€ì…ì´ ì‹±ê¸€í„´ì„ ë§Œë“œëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì´ë‹¤. ë‹¨, ë§Œë“¤ë ¤ë©´ ì‹±ê¸€í„´ì´ Enum ì™¸ì˜ í´ë˜ìŠ¤ë¥¼ ìƒì†í•´ì•¼ í•œë‹¤ë©´ ì´ ë°©ë²•ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.